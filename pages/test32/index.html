<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>test32</title>
    
    <!-- âœ… Chargement du CSS externe -->
    <link rel="stylesheet" href="../../static/css/viewer.css">
    
    <!-- Styles spÃ©cifiques Ã  la page (si nÃ©cessaire) -->
    <style>
        /* Hauteur minimale du canvas */
        .canvas-container {
            min-height: 580px;
        }
    </style>
</head>
<body>
    <nav class="sidebar">
        <div class="sidebar-header">
            <h2>ðŸ“š test32</h2>
        </div>
        
        <div class="nav-toggle">
            <button class="nav-btn active" data-tab="links">ðŸ”— Liens</button>
            <button class="nav-btn" data-tab="toc">ðŸ“‹ Sommaire</button>
        </div>
        
        <div class="nav-content" id="nav-links">
            <div class="nav-section" id="internal-links-section" style="display:none;">
                <div class="nav-section-title">Liens rÃ©fÃ©rencÃ©s</div>
                <ul class="sidebar-nav" id="internal-links-list"></ul>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Autres pages</div>
                <ul class="sidebar-nav" id="other-pages-list"></ul>
            </div>
        </div>
        
        <div class="nav-content" id="nav-toc" style="display:none;">
            <ul class="toc-list" id="toc-list">
                <li style="color: #666; font-size: 12px; padding: 10px;">Aucun titre trouvÃ©</li>
            </ul>
        </div>
    </nav>
    
    <main class="content">
        <div class="canvas-container">
<div class="component component-text" id="comp-1" style="left:530px;top:280px;width:300px;height:200px;z-index:0;">
<div class="text-content"></div>
</div>
<div class="component component-image" id="comp-2" style="left:40px;top:40px;width:300px;height:200px;z-index:1;">
<img src="" alt="Image" />
</div>
<div class="component component-shape" id="comp-3" style="left:1020px;top:80px;width:300px;height:200px;z-index:2;">
<div style="width:100%;height:100%;background:#333333;border-radius:5px;"></div>
</div>

        </div>
    </main>
    
    <div class="link-preview" id="link-preview">
        <div class="preview-header" id="preview-title"></div>
        <div class="preview-content" id="preview-content"></div>
        <div class="preview-footer">Cliquez pour ouvrir â†’</div>
    </div>
    
    <script>
        const PAGE_HEADINGS = [];
        const INTERNAL_LINKS = [];
        const CURRENT_SLUG = "test32";
        const PAGES_METADATA = {"test": {"title": "test", "slug": "test", "preview": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean blandit justo in magna condimentum interdum. Duis felis tellus, consequat eget venenatis ac, auctor ac erat. Fusce suscipit, diam sed co...", "hidden_from_nav": false}, "test2": {"title": "test2", "slug": "test2", "preview": "test", "hidden_from_nav": false}, "test3": {"title": "test3", "slug": "test3", "preview": "test 2 , test 4", "hidden_from_nav": true}, "test4": {"title": "test4", "slug": "test4", "preview": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent placerat maximus erat non iaculis. Vivamus non interdum velit. Sed eleifend posuere tempus. Duis aliquet magna erat, at finibus dolor ...", "hidden_from_nav": false}, "test6": {"title": "test6", "slug": "test6", "preview": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent placerat maximus erat non iaculis. Vivamus non interdum velit. Sed eleifend posuere tempus. Duis aliquet magna erat, at finibus dolor ...", "hidden_from_nav": false}, "test7": {"title": "test7", "slug": "test7", "preview": "Titre Test ceci est encore un test test lien", "hidden_from_nav": false}, "test8": {"title": "test8", "slug": "test8", "preview": "Page sans texte", "hidden_from_nav": false}, "test9": {"title": "test9", "slug": "test9", "preview": "ABAAAA TEST", "hidden_from_nav": false}, "test10": {"title": "test10", "slug": "test10", "preview": "test", "hidden_from_nav": false}, "test11": {"title": "test11", "slug": "test11", "preview": "Page vide", "hidden_from_nav": false}, "ufb": {"title": "UFB", "slug": "ufb", "preview": "Lâ€™Union FÃ©dÃ©rale Balte (UFB) est une organisation politique et militaire regroupant plusieurs Ã‰tats souverains dâ€™Europe du Nord et de la rÃ©gion baltique. FondÃ©e dans un contexte dâ€™instabilitÃ© internat...", "hidden_from_nav": false}, "test12": {"title": "test12", "slug": "test12", "preview": "Page sans contenu", "hidden_from_nav": false}, "test13": {"title": "test13", "slug": "test13", "preview": "Page sans texte", "hidden_from_nav": false}, "test14": {"title": "test14", "slug": "test14", "preview": "test", "hidden_from_nav": false}, "test15": {"title": "test15", "slug": "test15", "preview": "Page vide", "hidden_from_nav": false}, "test16": {"title": "test16", "slug": "test16", "preview": "Page vide", "hidden_from_nav": false}, "test17": {"title": "test17", "slug": "test17", "preview": "test UFB test", "hidden_from_nav": false}, "test18": {"title": "test18", "slug": "test18", "preview": "Test je sais pus combien test 15 test", "hidden_from_nav": false}, "test18-18": {"title": "test18", "slug": "test18-18", "preview": "Page vide", "hidden_from_nav": false}, "test19": {"title": "test19", "slug": "test19", "preview": "test1 test2 test3", "hidden_from_nav": false}, "test20": {"title": "test20", "slug": "test20", "preview": "test test test", "hidden_from_nav": false}, "test21": {"title": "test21", "slug": "test21", "preview": "Test2 test2 test", "hidden_from_nav": false}, "test22": {"title": "test22", "slug": "test22", "preview": "Test", "hidden_from_nav": false}, "test23": {"title": "test23", "slug": "test23", "preview": "Page vide", "hidden_from_nav": false}, "test24": {"title": "test24", "slug": "test24", "preview": "Page vide", "hidden_from_nav": false}, "test25": {"title": "test25", "slug": "test25", "preview": "test test", "hidden_from_nav": false}, "test26": {"title": "test26", "slug": "test26", "preview": "Test", "hidden_from_nav": false}, "test27": {"title": "test27", "slug": "test27", "preview": "TEST 150 OU JSP COMBIEN testtst", "hidden_from_nav": false}, "test28": {"title": "test28", "slug": "test28", "preview": "test21", "hidden_from_nav": false}, "test29": {"title": "test29", "slug": "test29", "preview": "Test15", "hidden_from_nav": false}, "test30": {"title": "test30", "slug": "test30", "preview": "Test30 test40 Lorem ipsum", "hidden_from_nav": false}, "test31": {"title": "test31", "slug": "test31", "preview": "Page sans texte", "hidden_from_nav": false}, "test32": {"title": "test32", "slug": "test32", "preview": "Page sans texte", "hidden_from_nav": false}, "test33": {"title": "test33", "slug": "test33", "preview": "Test 1 Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum ultricies lorem libero, et volutpat massa pharetra in. Nunc vehicula justo ac neque aliquet, id cursus felis malesuada. Donec...", "hidden_from_nav": false}};
        
        fetch('../../data/inventory.json')
            .then(res => res.json())
            .then(pages => {
                const visiblePages = pages.filter(p => !p.hidden_from_nav);
                const referencedPages = visiblePages.filter(p => INTERNAL_LINKS.includes(p.slug) && p.slug !== CURRENT_SLUG);
                const otherPages = visiblePages.filter(p => !INTERNAL_LINKS.includes(p.slug) && p.slug !== CURRENT_SLUG);
                
                if (referencedPages.length > 0) {
                    document.getElementById('internal-links-section').style.display = 'block';
                    const internalList = document.getElementById('internal-links-list');
                    referencedPages.forEach(page => {
                        const li = document.createElement('li');
                        const a = document.createElement('a');
                        a.href = `../${page.slug}/`;
                        a.textContent = page.title;
                        li.appendChild(a);
                        internalList.appendChild(li);
                    });
                }
                
                const otherList = document.getElementById('other-pages-list');
                otherPages.forEach(page => {
                    const li = document.createElement('li');
                    const a = document.createElement('a');
                    a.href = `../${page.slug}/`;
                    a.textContent = page.title;
                    li.appendChild(a);
                    otherList.appendChild(li);
                });
            })
            .catch(err => console.error('Erreur chargement navigation:', err));
        
        if (PAGE_HEADINGS.length > 0) {
            const tocList = document.getElementById('toc-list');
            tocList.innerHTML = '';
            PAGE_HEADINGS.forEach(heading => {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = `#${heading.id}`;
                a.textContent = heading.text;
                a.classList.add(`level-${heading.level}`);
                a.addEventListener('click', (e) => {
                    e.preventDefault();
                    const target = document.getElementById(heading.id);
                    if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
                li.appendChild(a);
                tocList.appendChild(li);
            });
        }
        
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const tab = btn.dataset.tab;
                document.getElementById('nav-links').style.display = tab === 'links' ? 'block' : 'none';
                document.getElementById('nav-toc').style.display = tab === 'toc' ? 'block' : 'none';
            });
        });
        
        const preview = document.getElementById('link-preview');
        let previewTimeout;
        let isOverPreview = false;
        
        function showLinkPreview(linkElement) {
            const href = linkElement.getAttribute('href');
            const match = href.match(/\.\.\/([^\/]+)\//);
            if (!match) return;
            
            const targetSlug = match[1];
            const metadata = PAGES_METADATA[targetSlug];
            
            if (!metadata) {
                console.warn('Pas de mÃ©tadonnÃ©es pour', targetSlug);
                return;
            }
            
            document.getElementById('preview-title').textContent = metadata.title;
            document.getElementById('preview-content').textContent = metadata.preview;
            
            const rect = linkElement.getBoundingClientRect();
            preview.style.display = 'block';
            
            let left = rect.right + 15;
            let top = rect.top;
            
            if (left + 400 > window.innerWidth) {
                left = rect.left - 415;
            }
            
            if (top + 250 > window.innerHeight) {
                top = window.innerHeight - 260;
            }
            
            preview.style.left = left + 'px';
            preview.style.top = top + 'px';
        }
        
        document.querySelectorAll('.text-content a[href*="../"]').forEach(link => {
            link.addEventListener('mouseenter', (e) => {
                clearTimeout(previewTimeout);
                previewTimeout = setTimeout(() => {
                    showLinkPreview(e.target);
                }, 300);
            });
            
            link.addEventListener('mouseleave', () => {
                clearTimeout(previewTimeout);
                setTimeout(() => {
                    if (!isOverPreview) {
                        preview.style.display = 'none';
                    }
                }, 200);
            });
        });
        
        preview.addEventListener('mouseenter', () => {
            isOverPreview = true;
        });
        
        preview.addEventListener('mouseleave', () => {
            isOverPreview = false;
            preview.style.display = 'none';
        });
        
        document.querySelectorAll('.component-gallery img').forEach(img => {
            img.addEventListener('click', () => {
                const lightbox = document.createElement('div');
                lightbox.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);display:flex;align-items:center;justify-content:center;z-index:10000;cursor:pointer';
                const enlargedImg = document.createElement('img');
                enlargedImg.src = img.src;
                enlargedImg.style.cssText = 'max-width:90%;max-height:90%;object-fit:contain';
                lightbox.appendChild(enlargedImg);
                lightbox.onclick = () => lightbox.remove();
                document.body.appendChild(lightbox);
            });
        });
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });
        
        document.querySelectorAll('.component').forEach(component => {
            component.style.opacity = '0';
            component.style.transform = 'translateY(20px)';
            component.style.transition = 'opacity 0.5s ease-out, transform 0.5s ease-out';
            observer.observe(component);
        });
        
        console.log('âœ… Viewer initialisÃ©');
        console.log('ðŸ“Š MÃ©tadonnÃ©es:', Object.keys(PAGES_METADATA).length, 'pages');
    </script>
</body>
</html>