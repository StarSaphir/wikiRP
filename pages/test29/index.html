<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>test29</title>
    
    <!-- ‚úÖ Chargement du CSS externe -->
    <link rel="stylesheet" href="../../static/css/viewer.css">
    
    <!-- Styles sp√©cifiques √† la page (si n√©cessaire) -->
    <style>
        /* Hauteur minimale du canvas */
        .canvas-container {
            min-height: 350px;
        }
        
        /* Style du bouton d'accueil */
        .home-btn {
            display: block;
            width: calc(100% - 4px); /* L√©g√®rement plus petit pour √©viter le d√©bordement */
            padding: 10px;
            background: linear-gradient(135deg, #4a9eff, #667eea);
            border: none;
            color: white;
            border-radius: 6px;
            text-decoration: none;
            text-align: center;
            font-weight: bold;
            font-size: 13px;
            margin: 12px 0 0 0; /* Retirer les marges lat√©rales */
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(74, 158, 255, 0.3);
        }
        
        .home-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(74, 158, 255, 0.5);
        }
        
        /* Ajustement de la sidebar header pour un meilleur espacement */
        .sidebar-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #4a9eff;
        }
    </style>
</head>
<body>
    <nav class="sidebar">
        <div class="sidebar-header">
            <h2>üìö test29</h2>
            <a href="../../wiki/" class="home-btn">
                üè† Retour √† l'accueil
            </a>
        </div>
        <div class="nav-toggle">
            <button class="nav-btn active" data-tab="links">üîó Liens</button>
            <button class="nav-btn" data-tab="toc">üìã Sommaire</button>
        </div>
        
        <div class="nav-content" id="nav-links">
            <div class="nav-section" id="internal-links-section" style="display:none;">
                <div class="nav-section-title">Liens r√©f√©renc√©s</div>
                <ul class="sidebar-nav" id="internal-links-list"></ul>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Autres pages</div>
                <ul class="sidebar-nav" id="other-pages-list"></ul>
            </div>
        </div>
        
        <div class="nav-content" id="nav-toc" style="display:none;">
            <ul class="toc-list" id="toc-list">
                <li style="color: #666; font-size: 12px; padding: 10px;">Aucun titre trouv√©</li>
            </ul>
        </div>
    </nav>
    
    <main class="content">
        <div class="canvas-container">
<div class="component component-text" id="comp-1" style="left:50px;top:50px;width:300px;height:200px;z-index:0;">
<div class="text-content"><p>Test15</p></div>
</div>

        </div>
    </main>
    
    <div class="link-preview" id="link-preview">
        <div class="preview-header" id="preview-title"></div>
        <div class="preview-content" id="preview-content"></div>
        <div class="preview-footer">Cliquez pour ouvrir ‚Üí</div>
    </div>
    
    <script>
        const PAGE_HEADINGS = [];
        const INTERNAL_LINKS = [];
        const CURRENT_SLUG = "test29";
        const PAGES_METADATA = {"test": {"title": "test", "slug": "test", "preview": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean blandit justo in magna condimentum interdum. Duis felis tellus, consequat eget venenatis ac, auctor ac erat. Fusce suscipit, diam sed co...", "hidden_from_nav": false, "tags": []}, "test2": {"title": "test2", "slug": "test2", "preview": "test", "hidden_from_nav": false, "tags": []}, "test3": {"title": "test3", "slug": "test3", "preview": "test 2 , test 4", "hidden_from_nav": true, "tags": []}, "test4": {"title": "test4", "slug": "test4", "preview": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent placerat maximus erat non iaculis. Vivamus non interdum velit. Sed eleifend posuere tempus. Duis aliquet magna erat, at finibus dolor ...", "hidden_from_nav": false, "tags": []}, "test6": {"title": "test6", "slug": "test6", "preview": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent placerat maximus erat non iaculis. Vivamus non interdum velit. Sed eleifend posuere tempus. Duis aliquet magna erat, at finibus dolor ...", "hidden_from_nav": false, "tags": []}, "test7": {"title": "test7", "slug": "test7", "preview": "Titre Test ceci est encore un test test lien", "hidden_from_nav": false, "tags": []}, "test8": {"title": "test8", "slug": "test8", "preview": "Page sans texte", "hidden_from_nav": false, "tags": []}, "test9": {"title": "test9", "slug": "test9", "preview": "ABAAAA TEST", "hidden_from_nav": false, "tags": []}, "test10": {"title": "test10", "slug": "test10", "preview": "test", "hidden_from_nav": false, "tags": []}, "test11": {"title": "test11", "slug": "test11", "preview": "Page vide", "hidden_from_nav": false, "tags": []}, "ufb": {"title": "UFB", "slug": "ufb", "preview": "L‚ÄôUnion F√©d√©rale Balte (UFB) est une organisation politique et militaire regroupant plusieurs √âtats souverains d‚ÄôEurope du Nord et de la r√©gion baltique. Fond√©e dans un contexte d‚Äôinstabilit√© internat...", "hidden_from_nav": false, "tags": []}, "test12": {"title": "test12", "slug": "test12", "preview": "Page sans contenu", "hidden_from_nav": false, "tags": []}, "test13": {"title": "test13", "slug": "test13", "preview": "Page sans texte", "hidden_from_nav": false, "tags": []}, "test14": {"title": "test14", "slug": "test14", "preview": "test", "hidden_from_nav": false, "tags": []}, "test15": {"title": "test15", "slug": "test15", "preview": "Page vide", "hidden_from_nav": false, "tags": []}, "test16": {"title": "test16", "slug": "test16", "preview": "Page vide", "hidden_from_nav": false, "tags": []}, "test17": {"title": "test17", "slug": "test17", "preview": "test UFB test", "hidden_from_nav": false, "tags": []}, "test18": {"title": "test18", "slug": "test18", "preview": "Test je sais pus combien test 15 test", "hidden_from_nav": false, "tags": []}, "test18-18": {"title": "test18", "slug": "test18-18", "preview": "Page vide", "hidden_from_nav": false, "tags": []}, "test19": {"title": "test19", "slug": "test19", "preview": "test1 test2 test3", "hidden_from_nav": false, "tags": []}, "test20": {"title": "test20", "slug": "test20", "preview": "test test test", "hidden_from_nav": false, "tags": []}, "test21": {"title": "test21", "slug": "test21", "preview": "Test2 test2 test", "hidden_from_nav": false, "tags": []}, "test22": {"title": "test22", "slug": "test22", "preview": "Test", "hidden_from_nav": false, "tags": []}, "test23": {"title": "test23", "slug": "test23", "preview": "Page vide", "hidden_from_nav": false, "tags": []}, "test24": {"title": "test24", "slug": "test24", "preview": "Page vide", "hidden_from_nav": false, "tags": []}, "test25": {"title": "test25", "slug": "test25", "preview": "test test", "hidden_from_nav": false, "tags": []}, "test26": {"title": "test26", "slug": "test26", "preview": "Test", "hidden_from_nav": false, "tags": []}, "test27": {"title": "test27", "slug": "test27", "preview": "TEST 150 OU JSP COMBIEN testtst", "hidden_from_nav": false, "tags": []}, "test28": {"title": "test28", "slug": "test28", "preview": "test21", "hidden_from_nav": false, "tags": []}, "test29": {"title": "test29", "slug": "test29", "preview": "Test15", "hidden_from_nav": false, "tags": []}, "test30": {"title": "test30", "slug": "test30", "preview": "Test30 test40 Lorem ipsum", "hidden_from_nav": false, "tags": []}, "test31": {"title": "test31", "slug": "test31", "preview": "Page sans texte", "hidden_from_nav": false, "tags": []}, "test32": {"title": "test32", "slug": "test32", "preview": "Page sans texte", "hidden_from_nav": false, "tags": []}, "test33": {"title": "test33", "slug": "test33", "preview": "Test 1 Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum ultricies lorem libero, et volutpat massa pharetra in. Nunc vehicula justo ac neque aliquet, id cursus felis malesuada. Donec...", "hidden_from_nav": false, "tags": []}, "test34": {"title": "test34", "slug": "test34", "preview": "Test 4 Test5", "hidden_from_nav": false, "tags": []}, "test35": {"title": "test35", "slug": "test35", "preview": "Test", "hidden_from_nav": false, "tags": []}, "test36": {"title": "test36", "slug": "test36", "preview": "Test15", "hidden_from_nav": false, "tags": ["test3", "test5", "test4"]}};

        const homeBtn = document.querySelector('.home-btn');
        if (homeBtn) {
            homeBtn.addEventListener('mouseenter', () => {
                homeBtn.style.transform = 'translateY(-2px)';
                homeBtn.style.boxShadow = '0 4px 15px rgba(74, 158, 255, 0.5)';
            });
            homeBtn.addEventListener('mouseleave', () => {
                homeBtn.style.transform = 'translateY(0)';
                homeBtn.style.boxShadow = '0 2px 8px rgba(74, 158, 255, 0.3)';
            });
        }
        
        fetch('../../data/inventory.json')
            .then(res => res.json())
            .then(pages => {
                const visiblePages = pages.filter(p => !p.hidden_from_nav);
                const referencedPages = visiblePages.filter(p => INTERNAL_LINKS.includes(p.slug) && p.slug !== CURRENT_SLUG);
                const otherPages = visiblePages.filter(p => !INTERNAL_LINKS.includes(p.slug) && p.slug !== CURRENT_SLUG);
                
                if (referencedPages.length > 0) {
                    document.getElementById('internal-links-section').style.display = 'block';
                    const internalList = document.getElementById('internal-links-list');
                    referencedPages.forEach(page => {
                        const li = document.createElement('li');
                        const a = document.createElement('a');
                        a.href = `../${page.slug}/`;
                        a.textContent = page.title;
                        li.appendChild(a);
                        internalList.appendChild(li);
                    });
                }
                
                const otherList = document.getElementById('other-pages-list');
                otherPages.forEach(page => {
                    const li = document.createElement('li');
                    const a = document.createElement('a');
                    a.href = `../${page.slug}/`;
                    a.textContent = page.title;
                    li.appendChild(a);
                    otherList.appendChild(li);
                });
            })
            .catch(err => console.error('Erreur chargement navigation:', err));
        
        if (PAGE_HEADINGS.length > 0) {
            const tocList = document.getElementById('toc-list');
            tocList.innerHTML = '';
            PAGE_HEADINGS.forEach(heading => {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = `#${heading.id}`;
                a.textContent = heading.text;
                a.classList.add(`level-${heading.level}`);
                a.addEventListener('click', (e) => {
                    e.preventDefault();
                    const target = document.getElementById(heading.id);
                    if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
                li.appendChild(a);
                tocList.appendChild(li);
            });
        }
        
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const tab = btn.dataset.tab;
                document.getElementById('nav-links').style.display = tab === 'links' ? 'block' : 'none';
                document.getElementById('nav-toc').style.display = tab === 'toc' ? 'block' : 'none';
            });
        });
        
        const preview = document.getElementById('link-preview');
        let previewTimeout;
        let isOverPreview = false;
        
        function showLinkPreview(linkElement) {
            const href = linkElement.getAttribute('href');
            const match = href.match(/\.\.\/([^\/]+)\//);
            if (!match) return;
            
            const targetSlug = match[1];
            const metadata = PAGES_METADATA[targetSlug];
            
            if (!metadata) {
                console.warn('Pas de m√©tadonn√©es pour', targetSlug);
                return;
            }
            
            document.getElementById('preview-title').textContent = metadata.title;
            document.getElementById('preview-content').textContent = metadata.preview;
            
            const rect = linkElement.getBoundingClientRect();
            preview.style.display = 'block';
            
            let left = rect.right + 15;
            let top = rect.top;
            
            if (left + 400 > window.innerWidth) {
                left = rect.left - 415;
            }
            
            if (top + 250 > window.innerHeight) {
                top = window.innerHeight - 260;
            }
            
            preview.style.left = left + 'px';
            preview.style.top = top + 'px';
        }
        
        document.querySelectorAll('.text-content a[href*="../"]').forEach(link => {
            link.addEventListener('mouseenter', (e) => {
                clearTimeout(previewTimeout);
                previewTimeout = setTimeout(() => {
                    showLinkPreview(e.target);
                }, 300);
            });
            
            link.addEventListener('mouseleave', () => {
                clearTimeout(previewTimeout);
                setTimeout(() => {
                    if (!isOverPreview) {
                        preview.style.display = 'none';
                    }
                }, 200);
            });
        });
        
        preview.addEventListener('mouseenter', () => {
            isOverPreview = true;
        });
        
        preview.addEventListener('mouseleave', () => {
            isOverPreview = false;
            preview.style.display = 'none';
        });
        
        document.querySelectorAll('.component-gallery img').forEach(img => {
            img.addEventListener('click', () => {
                const lightbox = document.createElement('div');
                lightbox.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);display:flex;align-items:center;justify-content:center;z-index:10000;cursor:pointer';
                const enlargedImg = document.createElement('img');
                enlargedImg.src = img.src;
                enlargedImg.style.cssText = 'max-width:90%;max-height:90%;object-fit:contain';
                lightbox.appendChild(enlargedImg);
                lightbox.onclick = () => lightbox.remove();
                document.body.appendChild(lightbox);
            });
        });
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });
        
        document.querySelectorAll('.component').forEach(component => {
            component.style.opacity = '0';
            component.style.transform = 'translateY(20px)';
            component.style.transition = 'opacity 0.5s ease-out, transform 0.5s ease-out';
            observer.observe(component);
        });
        
        console.log('‚úÖ Viewer initialis√©');
        console.log('üìä M√©tadonn√©es:', Object.keys(PAGES_METADATA).length, 'pages');
    </script>
    
    
    <!-- Pop-in d'avertissement pour pages cach√©es -->
    <!-- Page publique -->
        <div class="hidden-warning-modal">
            <div class="warning-icon">‚ö†Ô∏è</div>
            <h2>Page √† acc√®s restreint</h2>
            <p class="warning-text">
                Les informations contenues dans cette page <strong>ne sont pas publiques en RP</strong>.
            </p>
            <p class="warning-subtext">
                Elles ne peuvent √™tre exploit√©es sans l'accord explicite d'un <strong>Ma√Ætre de Jeu</strong> 
                ou du <strong>joueur du pays concern√©</strong>.
            </p>
            <div class="warning-actions">
                <button id="accept-warning" class="btn-accept">
                    J'ai compris
                </button>
            </div>
        </div>
    
    
    <style>
        .hidden-warning-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .hidden-warning-modal {
            background: linear-gradient(135deg, #1a1a2e 0%, #2d2d44 100%);
            border: 2px solid #ff6b6b;
            border-radius: 20px;
            padding: 50px 40px;
            max-width: 600px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(255, 107, 107, 0.3);
            animation: slideUp 0.4s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .warning-icon {
            font-size: 80px;
            margin-bottom: 25px;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .hidden-warning-modal h2 {
            color: #ff6b6b;
            font-size: 32px;
            margin-bottom: 25px;
            font-weight: 700;
        }
        
        .warning-text {
            color: #e0e0e0;
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .warning-text strong {
            color: #ff6b6b;
            font-weight: 700;
        }
        
        .warning-subtext {
            color: #999;
            font-size: 15px;
            line-height: 1.6;
            margin-bottom: 35px;
            padding: 20px;
            background: rgba(255, 107, 107, 0.1);
            border-radius: 10px;
            border-left: 4px solid #ff6b6b;
        }
        
        .warning-subtext strong {
            color: #4a9eff;
        }
        
        .warning-actions {
            margin-top: 30px;
        }
        
        .btn-accept {
            background: linear-gradient(135deg, #4a9eff, #667eea);
            color: white;
            border: none;
            padding: 15px 50px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(74, 158, 255, 0.3);
        }
        
        .btn-accept:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(74, 158, 255, 0.5);
        }
        
        .btn-accept:active {
            transform: translateY(-1px);
        }
        
        @media (max-width: 768px) {
            .hidden-warning-modal {
                margin: 20px;
                padding: 40px 30px;
            }
            
            .warning-icon {
                font-size: 60px;
            }
            
            .hidden-warning-modal h2 {
                font-size: 24px;
            }
            
            .warning-text {
                font-size: 16px;
            }
        }
    </style>
    
    <script>
        // Gestion de la pop-in d'avertissement
        const warningOverlay = document.getElementById('hidden-page-warning');
        const acceptBtn = document.getElementById('accept-warning');
        
        if (warningOverlay && acceptBtn) {
            // Emp√™cher le scroll en arri√®re-plan
            document.body.style.overflow = 'hidden';
            
            acceptBtn.addEventListener('click', () => {
                warningOverlay.style.animation = 'fadeOut 0.3s ease-out';
                
                setTimeout(() => {
                    warningOverlay.remove();
                    document.body.style.overflow = '';
                }, 300);
            });
            
            // Emp√™cher la fermeture en cliquant √† c√¥t√©
            warningOverlay.addEventListener('click', (e) => {
                if (e.target === warningOverlay) {
                    // Animation de secousse pour indiquer qu'on doit cliquer sur le bouton
                    const modal = warningOverlay.querySelector('.hidden-warning-modal');
                    modal.style.animation = 'shake 0.5s ease-in-out';
                    setTimeout(() => {
                        modal.style.animation = '';
                    }, 500);
                }
            });
        }
    </script>
    
    <style>
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
    </style>
</body>
</html>