<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architect Editor - {{ slug }}</title>
    
    <!-- Quill CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.snow.css">
    
    <!-- Editor CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='./css/editor.css') }}">
</head>
<body>
    <div class="editor-container">
        <!-- Toolbar Gauche -->
        <aside class="toolbar">
            <div class="toolbar-header">
                <div class="toolbar-tabs">
                    <button class="tab-btn active" data-tab="add">â• Ajouter</button>
                    <button class="tab-btn" data-tab="list">ğŸ“‹ Liste</button>
                </div>
            </div>
            
            <!-- Onglet Ajouter -->
            <div class="tab-content active" id="tab-add">
                <p style="color: #666; font-size: 12px; margin-bottom: 15px;">Glissez-dÃ©posez sur le canvas</p>
                <button class="tool-btn" data-type="text" draggable="true">ğŸ“ Texte Riche</button>
                <button class="tool-btn" data-type="image" draggable="true">ğŸ–¼ï¸ Image</button>
                <button class="tool-btn" data-type="gallery" draggable="true">ğŸï¸ Galerie</button>
                <button class="tool-btn" data-type="video" draggable="true">ğŸ¬ VidÃ©o</button>
                <button class="tool-btn" data-type="youtube" draggable="true">ğŸ“º YouTube</button>
                <button class="tool-btn" data-type="shape" draggable="true">â¬› Forme</button>
                <button class="tool-btn" data-type="table" draggable="true">ğŸ“Š Tableau</button>
                <button class="tool-btn" data-type="separator" draggable="true">â– SÃ©parateur</button>
            </div>
            
            <!-- Onglet Liste -->
            <div class="tab-content" id="tab-list">
                <p style="color: #666; font-size: 12px; margin-bottom: 15px;">Cliquez pour sÃ©lectionner</p>
                <div id="components-list"></div>
            </div>
            
            <div class="toolbar-section">
                <h4>Actions</h4>
                <button id="save-btn" class="action-btn">ğŸ’¾ Sauvegarder</button>
                <button id="copy-page-btn" class="action-btn">ğŸ“‹ Copier Layout</button>
                <button id="grid-toggle" class="action-btn">ğŸ”² Grille (ON)</button>
            </div>
        </aside>

        <!-- Canvas Principal -->
        <main class="canvas-area">
            <div class="canvas-toolbar">
                <button class="back-btn" onclick="window.location.href='/'">â¬…ï¸ Retour au Dashboard</button>
                <span class="page-title">{{ slug }}</span>
                <div class="canvas-controls">
                    <div class="mode-toggle">
                        <button id="mode-normal" class="mode-btn active" title="Mode normal">ğŸ–±ï¸ Normal</button>
                        <button id="mode-move" class="mode-btn" title="Mode dÃ©placement">âœ‹ DÃ©placement</button>
                    </div>
                    <label>
                        Grille: <input type="number" id="grid-size" value="10" min="5" max="50" step="5">px
                    </label>
                    <button id="preview-btn">ğŸ‘ï¸ PrÃ©visualiser</button>
                </div>
            </div>
            <div class="canvas" id="canvas">
                <div class="canvas-inner" id="canvas-inner"></div>
            </div>
        </main>

        <!-- Panneau PropriÃ©tÃ©s Droite -->
        <aside class="properties-panel" id="properties-panel">
            <div class="properties-header">
                <h3>PropriÃ©tÃ©s</h3>
                <button id="close-props">âœ•</button>
            </div>
            <div id="properties-content">
                <p class="no-selection">SÃ©lectionnez un composant</p>
            </div>
        </aside>
    </div>

    <!-- Modales (seront crÃ©Ã©es dynamiquement par les modules JS) -->
    <!-- Les modules modals/*.js crÃ©ent leurs propres modales -->

    <!-- Scripts -->
    <!-- Interact.js pour drag & resize -->
    <script src="https://cdn.jsdelivr.net/npm/interactjs@1.10.19/dist/interact.min.js"></script>
    
    <!-- Quill pour Ã©diteur de texte -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.min.js"></script>
    
    <!-- Injection des donnÃ©es Flask -->
    <script>
        window.SLUG = "{{ slug }}";
        window.INITIAL_LAYOUT = {{ layout|tojson|safe }};
    </script>
    
    <script>
        // DEBUG: Script Ã  ajouter temporairement dans editor.html AVANT main.js

        console.log('ğŸ” Script de dÃ©bogage des clics activÃ©');

        // Tracer TOUS les clics
        document.addEventListener('click', (e) => {
            console.log('ğŸ–±ï¸ CLIC dÃ©tectÃ©:', {
                target: e.target,
                tagName: e.target.tagName,
                className: e.target.className,
                id: e.target.id,
                isButton: e.target.tagName === 'BUTTON',
                hasStopPropagation: e.cancelBubble,
                defaultPrevented: e.defaultPrevented,
                composedPath: e.composedPath().map(el => el.tagName || el.nodeName)
            });
        }, true); // Capture phase

        // Tracer les arrÃªts de propagation
        const originalStopPropagation = Event.prototype.stopPropagation;
        Event.prototype.stopPropagation = function() {
            console.warn('â›” stopPropagation() appelÃ© par:', this.target, 'Type:', this.type);
            console.trace();
            originalStopPropagation.call(this);
        };

        // Tracer les preventDefault
        const originalPreventDefault = Event.prototype.preventDefault;
        Event.prototype.preventDefault = function() {
            console.warn('ğŸš« preventDefault() appelÃ© par:', this.target, 'Type:', this.type);
            originalPreventDefault.call(this);
        };

        // VÃ©rifier l'Ã©tat d'Ã©dition
        setInterval(() => {
            const isEditing = window.ArchitectEditor?.state?.isEditingTextMode();
            const editingId = window.ArchitectEditor?.state?.currentEditingTextId;
            
            if (isEditing) {
                console.log('ğŸ“ Mode Ã©dition actif:', editingId);
                
                // VÃ©rifier si le bouton "Terminer" existe
                const finishBtn = document.getElementById('finish-edit-btn') || 
                                document.getElementById('finish-table-edit-btn');
                
                if (finishBtn) {
                    console.log('âœ… Bouton Terminer trouvÃ©:', {
                        display: window.getComputedStyle(finishBtn).display,
                        pointerEvents: window.getComputedStyle(finishBtn).pointerEvents,
                        visibility: window.getComputedStyle(finishBtn).visibility,
                        zIndex: window.getComputedStyle(finishBtn).zIndex,
                        disabled: finishBtn.disabled
                    });
                } else {
                    console.error('âŒ Bouton Terminer NON TROUVÃ‰');
                }
            }
        }, 2000);

        // VÃ©rifier le panneau de propriÃ©tÃ©s
        setInterval(() => {
            const panel = document.getElementById('properties-panel');
            const content = document.getElementById('properties-content');
            
            if (panel) {
                console.log('ğŸ“‹ Panneau propriÃ©tÃ©s:', {
                    active: panel.classList.contains('active'),
                    pointerEvents: window.getComputedStyle(panel).pointerEvents,
                    contentPointerEvents: content ? window.getComputedStyle(content).pointerEvents : 'N/A'
                });
            }
        }, 3000);

        console.log('ğŸ” DÃ©bogage prÃªt. Ouvrez la console et testez les clics.');
    </script>

    <!-- Application principale (module ES6) -->
    <script type="module" src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>